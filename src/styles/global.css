@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base styles */
@layer base {
  html {
    scroll-behavior: smooth;
  }

  body {
    @apply font-sans;
  }

  /* Prose overrides for chapter content */
  .prose {
    @apply max-w-none;
  }

  .prose h1 {
    @apply text-4xl font-bold mb-6;
  }

  .prose h2 {
    @apply text-2xl font-bold mt-12 mb-4;
  }

  .prose h3 {
    @apply text-xl font-semibold mt-8 mb-3;
  }

  .prose p {
    @apply mb-4 leading-relaxed;
  }

  .prose ul, .prose ol {
    @apply mb-4 pl-6;
  }

  .prose li {
    @apply mb-2;
  }

  .prose a {
    @apply text-primary-600 hover:text-primary-800 underline;
    @apply dark:text-primary-400 dark:hover:text-primary-300;
  }

  .prose code {
    @apply bg-gray-100 dark:bg-gray-800 rounded px-1.5 py-0.5 text-sm font-mono;
  }

  .prose pre {
    @apply bg-gray-900 dark:bg-gray-950 text-gray-100 rounded-lg p-4 overflow-x-auto mb-4;
  }

  .prose pre code {
    @apply bg-transparent p-0 text-inherit;
  }

  .prose blockquote {
    @apply border-l-4 border-primary-300 dark:border-primary-600 pl-4 italic text-gray-700 dark:text-gray-300;
  }
}

/* Component styles */
@layer components {
  /* Complexity toggle */
  .complexity-toggle {
    @apply flex items-center gap-2 p-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700;
  }

  .complexity-toggle .toggle-label {
    @apply text-sm text-gray-600 dark:text-gray-400 mr-2;
  }

  .complexity-toggle .toggle-button {
    @apply flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition;
    @apply border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700;
  }

  .complexity-toggle .toggle-button.active {
    @apply bg-primary-100 dark:bg-primary-900 border-primary-300 dark:border-primary-600 text-primary-700 dark:text-primary-300;
  }

  .complexity-toggle .toggle-icon {
    @apply text-base;
  }

  /* Content layers */
  .content-layer {
    @apply my-6;
  }

  .layer-intuition {
    @apply bg-white dark:bg-gray-900;
  }

  .layer-mathematical,
  .layer-implementation,
  .layer-deepdive {
    @apply border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden;
  }

  /* Details/Summary based accordions */
  details.content-layer {
    @apply border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden;
  }

  details.content-layer > summary {
    @apply flex items-center gap-2 w-full px-4 py-3 text-left font-medium;
    @apply bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition cursor-pointer;
    @apply list-none; /* Remove default arrow */
  }

  /* Hide default marker in all browsers */
  details.content-layer > summary::-webkit-details-marker {
    display: none;
  }

  details.content-layer > summary::marker {
    display: none;
    content: '';
  }

  .layer-mathematical > summary {
    @apply bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50 text-blue-800 dark:text-blue-300;
  }

  .layer-implementation > summary {
    @apply bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50 text-green-800 dark:text-green-300;
  }

  .layer-deepdive > summary {
    @apply bg-purple-50 dark:bg-purple-900/30 hover:bg-purple-100 dark:hover:bg-purple-900/50 text-purple-800 dark:text-purple-300;
  }

  .layer-icon {
    @apply text-lg;
  }

  .layer-title {
    @apply flex-1;
  }

  /* Toggle icon that rotates when open */
  .layer-toggle-icon {
    @apply text-xl transition-transform duration-200;
  }

  .layer-toggle-icon::after {
    content: '+';
  }

  details[open] .layer-toggle-icon::after {
    content: '−';
  }

  .layer-content {
    @apply p-4;
  }

  /* Legacy button-based layer headers (for non-details elements) */
  .layer-header {
    @apply flex items-center gap-2 w-full px-4 py-3 text-left font-medium;
    @apply bg-gray-50 hover:bg-gray-100 transition cursor-pointer;
  }

  button.layer-header + .layer-content,
  .layer-intuition .layer-content {
    @apply p-4;
  }

  /* Content status */
  .content-status {
    @apply inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium;
  }

  .status-draft {
    @apply bg-yellow-100 dark:bg-yellow-900/40 text-yellow-800 dark:text-yellow-300;
  }

  .status-editor-reviewed {
    @apply bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-300;
  }

  .status-community-reviewed {
    @apply bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-300;
  }

  .status-verified {
    @apply bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-300;
  }

  /* Callouts */
  .callout {
    @apply my-6 rounded-lg border-l-4 overflow-hidden;
  }

  .callout-header {
    @apply flex items-center gap-2 px-4 py-2 font-medium;
  }

  .callout-content {
    @apply px-4 pb-4;
  }

  .callout-note {
    @apply bg-blue-50 dark:bg-blue-900/30 border-blue-400 dark:border-blue-500;
  }

  .callout-note .callout-header {
    @apply text-blue-800 dark:text-blue-300;
  }

  .callout-warning {
    @apply bg-amber-50 dark:bg-amber-900/30 border-amber-400 dark:border-amber-500;
  }

  .callout-warning .callout-header {
    @apply text-amber-800 dark:text-amber-300;
  }

  .callout-tip {
    @apply bg-green-50 dark:bg-green-900/30 border-green-400 dark:border-green-500;
  }

  .callout-tip .callout-header {
    @apply text-green-800 dark:text-green-300;
  }

  .callout-example {
    @apply bg-gray-50 dark:bg-gray-800 border-gray-400 dark:border-gray-500;
  }

  .callout-example .callout-header {
    @apply text-gray-800 dark:text-gray-300;
  }

  .callout-definition {
    @apply bg-indigo-50 dark:bg-indigo-900/30 border-indigo-400 dark:border-indigo-500;
  }

  .callout-definition .callout-header {
    @apply text-indigo-800 dark:text-indigo-300;
  }

  .callout-theorem {
    @apply bg-purple-50 dark:bg-purple-900/30 border-purple-400 dark:border-purple-500;
  }

  .callout-theorem .callout-header {
    @apply text-purple-800 dark:text-purple-300;
  }

  /* Chapter navigation */
  .chapter-objectives {
    @apply my-8 p-6 bg-primary-50 dark:bg-primary-900/30 rounded-xl border border-primary-200 dark:border-primary-700;
  }

  .objectives-title {
    @apply text-lg font-bold text-primary-900 dark:text-primary-100 mb-4;
  }

  .objectives-list {
    @apply space-y-2;
  }

  .objectives-list li {
    @apply flex items-start gap-2;
  }

  .objectives-list li::before {
    content: '✓';
    @apply text-primary-600 dark:text-primary-400 font-bold;
  }

  .next-chapter,
  .next-section {
    @apply flex items-center justify-between p-4 mt-8;
    @apply bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700;
    @apply hover:border-primary-300 dark:hover:border-primary-600 hover:shadow-md transition;
  }

  .next-label {
    @apply text-sm text-gray-500 dark:text-gray-400;
  }

  .next-title {
    @apply font-semibold text-gray-900 dark:text-gray-100;
  }

  .next-arrow {
    @apply text-2xl text-primary-600 dark:text-primary-400;
  }

  .cross-ref {
    @apply text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 underline;
  }

  .key-takeaways {
    @apply my-8 p-6 bg-green-50 dark:bg-green-900/30 rounded-xl border border-green-200 dark:border-green-700;
  }

  .takeaways-title {
    @apply text-lg font-bold text-green-900 dark:text-green-100 mb-4;
  }

  .colab-link {
    @apply inline-flex items-center gap-2 px-4 py-2 mt-4;
    @apply bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300 rounded-lg;
    @apply hover:bg-orange-200 dark:hover:bg-orange-900/60 transition;
  }

  /* Interactive components */
  .gridworld-container {
    @apply my-8 p-6 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700;
  }

  .grid-cell {
    @apply relative flex items-center justify-center;
    @apply border border-gray-300 dark:border-gray-600 transition-colors;
  }

  .agent {
    @apply text-2xl;
  }

  .goal {
    @apply text-2xl;
  }

  .policy-arrow {
    @apply text-gray-600 dark:text-gray-400 font-bold;
  }

  .controls {
    @apply flex flex-wrap items-center justify-center gap-4 mt-4;
  }

  .controls button {
    @apply px-4 py-2 bg-primary-600 text-white rounded-md;
    @apply hover:bg-primary-700 disabled:bg-gray-300 dark:disabled:bg-gray-700 disabled:cursor-not-allowed;
    @apply transition;
  }

  .controls label {
    @apply flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400;
  }

  .metrics {
    @apply text-center mt-4 text-sm text-gray-600 dark:text-gray-400;
  }
}

/* KaTeX overrides */
.katex {
  font-size: 1.1em;
}

.katex-display {
  @apply my-6 overflow-x-auto;
}

/* Utility classes */
@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}
