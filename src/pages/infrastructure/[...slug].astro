---
import BaseLayout from '../../layouts/BaseLayout.astro';

export function getStaticPaths() {
  const mdxModules = import.meta.glob('/content/infrastructure/*/index.mdx', { eager: true });
  const paths = [];

  for (const [path, module] of Object.entries(mdxModules)) {
    const mod = module as { frontmatter?: Record<string, unknown>; default: any };
    if (!mod.frontmatter) continue;

    const match = path.match(/\/content\/infrastructure\/([^/]+)\/index\.mdx$/);
    if (!match) continue;

    const dirName = match[1];
    const slug = (mod.frontmatter.slug as string) || dirName;

    paths.push({
      params: { slug },
      props: {
        Content: mod.default,
        frontmatter: mod.frontmatter,
        dirName,
      },
    });
  }

  return paths;
}

interface Props {
  Content: any;
  frontmatter: Record<string, unknown>;
  dirName: string;
}

const { Content, frontmatter, dirName } = Astro.props;
const title = (frontmatter.title as string) || 'Infrastructure Guide';
const description = (frontmatter.description as string) || '';
const status = (frontmatter.status as string) || 'draft';

const statusLabels: Record<string, string> = {
  draft: 'ğŸ“ AI Generated',
  editor_reviewed: 'âœ… Editor Reviewed',
  community_reviewed: 'ğŸ‘¥ Community Reviewed',
  verified: 'ğŸ”’ Verified',
};
---

<BaseLayout title={title} description={description}>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-4xl mx-auto px-4 py-8">
        <nav class="text-sm text-gray-500 dark:text-gray-400 mb-4">
          <a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">Home</a>
          <span class="mx-2">â†’</span>
          <a href="/infrastructure" class="hover:text-primary-600 dark:hover:text-primary-400">Infrastructure</a>
          <span class="mx-2">â†’</span>
          <span class="text-gray-900 dark:text-gray-100">{title}</span>
        </nav>
        <div class="flex items-center gap-3 mb-2">
          <span class="text-sm px-2 py-1 bg-cyan-100 dark:bg-cyan-900/50 text-cyan-800 dark:text-cyan-300 rounded-full">
            {statusLabels[status] || status}
          </span>
        </div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2">{title}</h1>
        {description && <p class="text-lg text-gray-600 dark:text-gray-300">{description}</p>}
      </div>
    </header>

    <!-- Content -->
    <main class="max-w-4xl mx-auto px-4 py-12">
      <article class="prose prose-lg dark:prose-invert max-w-none bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8">
        <Content />
      </article>

      <!-- Footer -->
      <footer class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-between items-center">
          <a href="/infrastructure" class="text-primary-600 dark:text-primary-400 hover:underline">
            â† Back to Infrastructure
          </a>
          <a
            href={`https://github.com/ebilgin/rlbook/blob/main/content/infrastructure/${dirName}/index.mdx`}
            class="text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400"
            target="_blank"
          >
            Edit on GitHub â†’
          </a>
        </div>
      </footer>
    </main>
  </div>
</BaseLayout>
