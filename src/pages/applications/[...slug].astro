---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { ComplexityToggle } from '../../components/ui/ComplexityToggle';

export function getStaticPaths() {
  const mdxModules = import.meta.glob('/content/applications/*/index.mdx', { eager: true });
  const paths = [];

  for (const [path, module] of Object.entries(mdxModules)) {
    const mod = module as { frontmatter?: Record<string, unknown>; default: any };
    if (!mod.frontmatter) continue;

    const match = path.match(/\/content\/applications\/([^/]+)\/index\.mdx$/);
    if (!match) continue;

    const dirName = match[1];
    const slug = (mod.frontmatter.slug as string) || dirName;

    paths.push({
      params: { slug },
      props: {
        Content: mod.default,
        frontmatter: mod.frontmatter,
        dirName,
      },
    });
  }

  return paths;
}

interface Props {
  Content: any;
  frontmatter: Record<string, unknown>;
  dirName: string;
}

const { Content, frontmatter, dirName } = Astro.props;
const title = (frontmatter.title as string) || 'Application';
const description = (frontmatter.description as string) || '';
const status = (frontmatter.status as string) || 'draft';

const statusLabels: Record<string, string> = {
  draft: 'üìù AI Generated',
  editor_reviewed: '‚úÖ Editor Reviewed',
  community_reviewed: 'üë• Community Reviewed',
  verified: 'üîí Verified',
};
---

<BaseLayout title={title} description={description}>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-4xl mx-auto px-4 py-8">
        <nav class="text-sm text-gray-500 dark:text-gray-400 mb-4">
          <a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">Home</a>
          <span class="mx-2">‚Üí</span>
          <a href="/applications" class="hover:text-primary-600 dark:hover:text-primary-400">Applications</a>
          <span class="mx-2">‚Üí</span>
          <span class="text-gray-900 dark:text-gray-100">{title}</span>
        </nav>
        <div class="flex items-center gap-3 mb-2">
          <span class="text-sm px-2 py-1 bg-rose-100 dark:bg-rose-900/50 text-rose-800 dark:text-rose-300 rounded-full">
            {statusLabels[status] || status}
          </span>
        </div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2">{title}</h1>
        {description && <p class="text-lg text-gray-600 dark:text-gray-300">{description}</p>}
      </div>
    </header>

    <!-- Content -->
    <main class="max-w-4xl mx-auto px-4 py-12">
      <!-- Complexity Toggle -->
      <div class="mb-8">
        <ComplexityToggle client:load />
      </div>

      <article class="prose prose-lg dark:prose-invert max-w-none bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8">
        <Content />
      </article>

      <!-- Footer -->
      <footer class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-between items-center mb-8">
          <a href="/applications" class="text-primary-600 dark:text-primary-400 hover:underline">
            ‚Üê Back to Applications
          </a>
          <a
            href={`https://github.com/ebilgin/rlbook/blob/main/content/applications/${dirName}/index.mdx`}
            class="text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400"
            target="_blank"
          >
            Edit on GitHub ‚Üí
          </a>
        </div>

        <!-- Comments -->
        <div id="giscus-container" class="mt-8">
          <script
            src="https://giscus.app/client.js"
            data-repo="ebilgin/rlbook"
            data-repo-id="R_kgDOQw0g7Q"
            data-category="General"
            data-category-id="DIC_kwDOQw0g7c4C0Yda"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="dark"
            data-lang="en"
            crossorigin="anonymous"
            async
          ></script>
        </div>
      </footer>
    </main>
  </div>
</BaseLayout>
